name: "Xanitizer Security Analysis"

on:
  # Run the workflow on each push
  push:
    branches:
      - master
  # Run the workflow each day at 5 am
  # schedule:
  #   - cron: '0 5 * * *'
  # Run the workflow manually
  #workflow_dispatch:

jobs:
  xanitizer-security-analysis:
    # Xanitizer runs on ubuntu-latest and windows-latest.
    runs-on: ubuntu-latest

    steps:
      - name: Prepare git
        run: git config --global core.autocrlf false

      # Check out the repository
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: set up JDK 11
        uses: actions/setup-java@v1
        with:
          java-version: 1.11

      - name: Make Maven Wrapper executable
        if: contains(matrix.os, 'win') == false
        run: |
          chmod +x ./mvnw

      # Compile the code for Java projects and get all libraries, e.g. via Maven
      - name: Build with Maven
        timeout-minutes: 20
        run: |
          ./mvnw clean package --file pom.xml --errors --batch-mode --lax-checksums -DskipTests=true -P"non_module_java","test-jar","xsd","dev"

        # Run the security analysis with default settings
      - name: Xanitizer Security Analysis
        uses: RIGS-IT/xanitizer-action@v1.0.0
        with:
          license: ${{ secrets.XANITIZER_LICENSE }}
